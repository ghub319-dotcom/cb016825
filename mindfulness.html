<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mindfulness</title>
<link rel="stylesheet" href="main.css">
</head>
<body>
<nav><div class="brand">GreenBite🍃</div><a href="index.html">Home🏠</a></nav>
<div style="text-align:right;font-size:1.1em;margin-bottom:8px;">
  <span id="clock"></span>
</div>
<main>
  <h1>Mindfulness</h1>
  <div class="card">
    <h2>Guided Breathing Cycle</h2>
    <p>Follow the inhale, hold, and exhale cycle below. The circle will expand and contract to guide your breathing.</p>
    <div id="breath" class="breath">Breathe</div>
    <div style="width:0;height:0;border-left:30px solid transparent;border-right:30px solid transparent;border-top:40px solid #0a680d;margin:16px auto;"></div>
    <p id="breathText"></p>
    <div id="cycleCount" style="font-weight:bold;color:#0a680d;margin-bottom:8px;">Cycle: 0</div>
    <div style="margin: 10px 0;">
      <span style="display:inline-block;width:16px;height:16px;background:skyblue;border-radius:50%;margin-right:6px;"></span> Inhale
      <span style="display:inline-block;width:16px;height:16px;background:lightgreen;border-radius:50%;margin:0 6px 0 16px;"></span> Exhale
    </div>
    <button onclick="startBreathing()">Start Breath🌬</button>
    <button onclick="stopBreathing()">Stop</button>
    <hr>
    <h3>Timer</h3>
    <input id="minInput" type="number" value="1" min="1"> min
    <button onclick="startTimer()">Start Session</button>
    <p id="sessionMsg"></p>
    <button id="soundToggle" onclick="toggleSound()">Toggle Ambient</button>
  </div>
</main>
<script>
// Live clock
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  document.getElementById('clock').textContent = `${h}:${m}:${s}`;
}
setInterval(updateClock, 1000);
updateClock();

const breathEl=document.getElementById("breath"),
      txt=document.getElementById("breathText"),
      msg=document.getElementById("sessionMsg"),
      btn=document.getElementById("soundToggle"),
      audio=new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3");
      
audio.loop=true;audio.volume=0.2;
let idx=0,timer,bSound=false,steps=[
  {t:4000,p:"Inhale",c:"inhale"},
  {t:2000,p:"Hold",c:""},
  {t:4000,p:"Exhale",c:"exhale"},
  {t:2000,p:"Hold",c:""}
];
let cycleNum = 0;
function cycle(){
  let s=steps[idx];
  breathEl.className="breath "+s.c;
  txt.textContent=s.p;
  if(idx===0) {
    cycleNum++;
    document.getElementById('cycleCount').textContent = `Cycle: ${cycleNum}`;
  }
  idx=(idx+1)%steps.length;
  timer=setTimeout(cycle,s.t);
}
function startBreathing(){
  cycleNum = 0;
  document.getElementById('cycleCount').textContent = `Cycle: 0`;
  idx = 0;
  cycle();
}
function stopBreathing(){
  clearTimeout(timer);
  idx=0;
  breathEl.className="breath";
  txt.textContent="";
  document.getElementById('cycleCount').textContent = `Cycle: 0`;
}
function startTimer(){
  let secs=(+document.getElementById("minInput").value||1)*60;
  msg.textContent="Session running...";
  const id=setInterval(()=>{if(--secs<=0){clearInterval(id);msg.textContent="Session complete!";track();}},1000);
}
function toggleSound(){bSound?audio.pause():audio.play();bSound=!bSound;btn.textContent=bSound?"Stop Ambient":"Toggle Ambient";}
function track(){let k="green_sessions",a=JSON.parse(localStorage[k]||"[]");a.push({when:new Date().toISOString()});localStorage[k]=JSON.stringify(a);}
</script>
</body>
</html>
